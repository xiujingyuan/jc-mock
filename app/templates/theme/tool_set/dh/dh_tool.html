<div>
    <div class="panel panel-default">
        <div class="panel-heading" >
            生成资产数据
        </div>
        <div class="panel-body dh-content">
             <form id="for_app" class="form-horizontal">
                <div class="form-group" style="margin-top:15px">
                    <label class="control-label col-sm-2" for="text_from_app">来源app名</label>
                    <div class="col-sm-10">
                        <div class="col-sm-2">
                            <input type="checkbox" id="cb_from_app_all" value="all"  style="margin: 10px;">全选
                        </div>
                        <div id="cb_from_app">
                            {% for from_app_key in dh_from_app %}
                                <div class="col-sm-2">
                                    <input type="checkbox" id="cb_from_app_{{ loop.index }}" value="{{ from_app_key }}" style="margin: 10px;">{{ dh_from_app[from_app_key].name }}
                                </div>
                            {% endfor %}
                        </div>
                        </div>
                </div>

            </form>


            <form id="for_system_cust_flag" class="form-horizontal">
                <div class="form-group" style="margin-top:15px">
                    <label class="control-label col-sm-2" for="text_cust_flag">用户类型</label>
                    <div class="col-sm-10">
                        <div class="col-sm-2">
                            <input type="checkbox" id="cb_cust_flg_all" value="all" style="margin: 10px;">全选
                        </div>
                        <div id="cb_cust_flgs">
                            <div class="col-sm-2">
                                <input type="checkbox" id="cb_cust_new" value="新用户" style="margin: 10px;">新用户
                            </div>
                            <div class="col-sm-2">
                                <input type="checkbox" id="cb_cust_old" value="老用户" style="margin: 10px;">老用户
                            </div>
                            <div class="col-sm-2">
                                <input type="checkbox" id="cb_cust_empty" value="" style="margin: 10px;">无
                            </div>
                        </div>
                    </div>
                </div>
            </form>


             <form id="for_system_d3_level" class="form-horizontal">
                <div class="form-group" style="margin-top:15px">
                    <label class="control-label col-sm-2" for="text_d3_level">C卡D3评级</label>
                    <div class="col-sm-10">
                        <div class="col-sm-2">
                            <input type="checkbox" id="cb_d3_level_all" value="all" style="margin: 10px;">全选
                        </div>
                        <div id="cb_d3_levels">
                            <div class="col-sm-2">
                                <input type="checkbox" id="cb_d3_level_1" value="1" style="margin: 10px;">1
                            </div>
                            <div class="col-sm-2">
                                <input type="checkbox" id="cb_d3_level_2" value="2" style="margin: 10px;">2
                            </div>
                            <div class="col-sm-2">
                                <input type="checkbox" id="cb_d3_level_3" value="3" style="margin: 10px;">3
                            </div>
                            <div class="col-sm-2">
                                <input type="checkbox" id="cb_d3_level_4" value="4" style="margin: 10px;">4
                            </div>
                            <div class="col-sm-2">
                                <input type="checkbox" id="cb_d3_level_5" value="5" style="margin: 10px;">5
                            </div>
                            <div class="col-sm-2">
                                <input type="checkbox" id="cb_d3_level_6" value="6" style="margin: 10px;">6
                            </div>
                            <div class="col-sm-2">
                                <input type="checkbox" id="cb_d3_level_7" value="7" style="margin: 10px;">7
                            </div>
                            <div class="col-sm-2">
                                <input type="checkbox" id="cb_d3_level_8" value="8" style="margin: 10px;">8
                            </div>
                            <div class="col-sm-2">
                                <input type="checkbox" id="cb_d3_level_9" value="9" style="margin: 10px;">9
                            </div>
                            <div class="col-sm-2">
                                <input type="checkbox" id="cb_d3_level_10" value="10" style="margin: 10px;">10
                            </div>
                            <div class="col-sm-2">
                                <input type="checkbox" id="cb_d3_level_empty" value="" style="margin: 10px;">无
                            </div>
                        </div>
                    </div>
                </div>
            </form>


            <form id="for_system_overdue_days" class="form-horizontal">
                <div class="form-group" style="margin-top:15px">
                    <label class="control-label col-sm-2" for="text_overdue_days">逾期天数</label>
                    <div class="col-sm-10">
                    <div class="col-sm-2">
                        <input type="text" data-toggle="逾期天数" id="text_overdue_days" style="margin: 10px;" value="1">
                    </div>
                    </div>
                </div>
            </form>

            <form id="for_system_overdue_amount" class="form-horizontal">
                <div class="form-group" style="margin-top:15px">
                    <label class="control-label col-sm-2" for="text_overdue_amount">逾期金额(元)</label>
                    <div class="col-sm-10">
                    <div class="col-sm-2">
                        <input type="text" data-toggle="逾期金额" id="text_overdue_amount" style="margin: 10px;" value="2000">
                    </div>
                    </div>
                </div>
            </form>

            <form id="for_env" class="form-horizontal">
                <div class="form-group" style="margin-top:15px">
                    <label class="control-label col-sm-2" for="text_env">测试环境【可填1，2，3，4】</label>
                    <div class="col-sm-10">
                    <div class="col-sm-2">
                        <input type="text" data-toggle="测试环境" id="text_env" style="margin: 10px;" value="1">
                    </div>
                    </div>
                </div>
            </form>


            <form id="for_system_count" class="form-horizontal">
                <div class="form-group" style="margin-top:15px">
                    <label class="control-label col-sm-2" for="text_count">创建条数</label>
                    <div class="col-sm-10">
                    <div class="col-sm-2">
                        <input type="text" data-toggle="创建条数" id="text_count" style="margin: 10px;" value="10">
                    </div>
                    </div>
                </div>
            </form>

            <div class="col-sm-2 pull-right">
                {% if check %}
                    <button class="btn btn-primary" id="id_create_sync" disabled="disabled">开始同步资产</button>
                {% else %}
                    <button class="btn btn-primary" id="id_create_sync" >开始同步资产</button>
                {% endif %}
            </div>

        </div>
    </div>
</div>


<script>
    $("#cb_from_app_all").click(function () {
        if(this.checked)
        {
            $("#cb_from_app :checkbox").prop("checked", true);

        }
        else{
            $("#cb_from_app :checkbox").prop("checked", false);
        }
    }).click();


    $("#cb_cust_flg_all").click(function () {
        if(this.checked)
        {
            $("#cb_cust_flgs :checkbox").prop("checked", true);

        }
        else{
            $("#cb_cust_flgs :checkbox").prop("checked", false);
        }
    }).click();

    $("#cb_d3_level_all").click(function () {
        if(this.checked)
        {
            $("#cb_d3_levels :checkbox").prop("checked", true);

        }
        else{
            $("#cb_d3_levels :checkbox").prop("checked", false);
        }
    }).click();

    var csrftoken = "{{ csrf_token() }}";

    $("#id_create_sync").click(function () {
        $(this).attr("disabled",true);
        var from_app = new Array();
        $("#cb_from_app :checkbox:checked ").each(function (index, item) {
            from_app.push(item.value);
        });

        var cust_flg = new Array();
        $("#cb_cust_flgs :checkbox:checked ").each(function (index, item) {
            cust_flg.push(item.value);
        });

        var d3_level = new Array();
        $("#cb_d3_levels :checkbox:checked ").each(function (index, item) {
            d3_level.push(item.value);
        });

        var text_overdue_days = parseInt($("#text_overdue_days").val());
        var text_overdue_amount = parseInt($("#text_overdue_amount").val());
        var task_count = parseInt($("#text_count").val());
        var text_env = parseInt($("#text_env").val());
        $.ajax({
                url : "/api/dh/create_asset_sync",
                contentType: "application/json; charset=UTF-8",
                headers: {"X-CSRFToken":csrftoken},
                async : true,
                type : "POST",
                data : JSON.stringify({
                        "item_cust_flg": cust_flg,
                        "overdue_days": text_overdue_days,
                        "specified_overdue_amount":true,
                        "overdue_amount": text_overdue_amount*100,
                        "asset_from_app": from_app,
                        "d3_level": d3_level,
                        "env":text_env,
                        "count": task_count
                    }),

                success : function(data) {
                    if(data["code"] == 0){
                        toastr.success("success", data.msg);
                    }
                    else{
                            toastr.error("error", data.msg);
                        }
                    $("#id_create_sync").removeAttr("disabled");
                },
                error : function() {
                    toastr.warning("warning", "网络异常，请求失败");
                    $("#id_create_task").removeAttr("disabled");
                },
                dataType : "json"
            });

    })
</script>

